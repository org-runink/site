<div
    class="relative w-full min-h-[70vh] flex items-center justify-center overflow-hidden bg-stone-950 group border-b border-stone-800">
    <!-- Background Effects -->
    <div
        class="absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-stone-900 via-stone-950 to-stone-950">
    </div>
    <div class="absolute inset-0 opacity-20"
        style="background-image: linear-gradient(#ea580c 1px, transparent 1px), linear-gradient(90deg, #ea580c 1px, transparent 1px); background-size: 60px 60px;">
    </div>

    <div
        class="relative z-20 max-w-[1400px] w-full mx-auto px-6 py-24 grid lg:grid-cols-2 gap-16 lg:gap-24 items-center">
        <!-- Left Side: Typography & Button -->
        <div class="max-w-xl {{ if eq (.Get "invert") "true" }}order-2 md:order-2{{ else }}order-2 md:order-1{{ end
            }}">
            {{ if .Get "pill" }}
            <div
                class="inline-flex items-center justify-center px-6 py-2 mb-6 rounded-lg border border-[#ea580c]/30 text-[#ea580c] text-sm md:text-base font-black uppercase tracking-[0.25em] bg-stone-900/50 backdrop-blur shadow-[0_0_15px_rgba(234,88,12,0.1)]">
                {{ .Get "pill" }}
            </div>
            {{ end }}
            <h2
                class="text-4xl md:text-5xl xl:text-7xl 2xl:text-[80px] whitespace-nowrap font-black text-transparent bg-clip-text bg-gradient-to-r from-[#ea580c] to-[#ca4708] mb-2 tracking-tighter uppercase italic drop-shadow-lg leading-[0.9]">
                {{ .Get "title" }}
            </h2>
            {{ if .Get "subtitle" }}
            <div class="text-stone-500 font-bold uppercase tracking-[0.15em] text-lg md:text-xl mb-10">
                {{ .Get "subtitle" }}
            </div>
            {{ end }}
            <a href="{{ .Get " url" }}"
                class="inline-flex items-center gap-3 px-8 py-4 bg-[#b92b3f] hover:bg-[#9a2133] text-white font-bold uppercase tracking-wider rounded-full transition-all duration-300 shadow-lg text-sm">
                Read Full Use Case <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3">
                    </path>
                </svg>
            </a>
        </div>

        <!-- Right Side: Process Steps -->
        <div class="w-full max-w-2xl mx-auto md:ml-auto relative z-10 {{ if eq (.Get "invert") "true" }}order-1
            md:order-1{{ else }}order-1 md:order-2{{ end }}">
            {{ $monitorText := .Get "monitor" | default "" }}
            {{ $cockpitText := .Get "cockpit" | default "" }}

            {{ $monitorLinesRaw := split $monitorText "\\n" }}
            {{ $cockpitLinesRaw := split $cockpitText "\\n" }}

            {{ $monitorLines := slice }}
            {{ range $monitorLinesRaw }}
            {{ $t := trim . " \n\r\\" }}
            {{ if ne $t "" }}{{ $monitorLines = $monitorLines | append $t }}{{ end }}
            {{ end }}

            {{ $cockpitLines := slice }}
            {{ range $cockpitLinesRaw }}
            {{ $t := trim . " \n\r\\" }}
            {{ if ne $t "" }}{{ $cockpitLines = $cockpitLines | append $t }}{{ end }}
            {{ end }}

            <div class="flex flex-col w-full pl-0 md:pl-6">

                {{ if .Get "problem" }}
                <div
                    class="mb-12 p-6 md:p-8 bg-[#111] border border-stone-800/80 rounded-[1.25rem] relative overflow-hidden group">
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-[#ea580c]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700">
                    </div>
                    <h4 class="text-white font-bold mb-3 flex items-center gap-3 tracking-tight">
                        <svg class="w-5 h-5 text-[#ea580c]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        The Operational Problem
                    </h4>
                    <div
                        class="text-stone-400 text-[13px] md:text-sm leading-relaxed prose prose-invert prose-p:last:mb-0">
                        {{ .Get "problem" | markdownify | safeHTML }}
                    </div>
                </div>
                {{ end }}

                <!-- Monitor Header -->
                <h3 class="text-lg font-bold text-white tracking-tight flex items-center gap-3 mb-4">
                    <span class="w-2 h-2 rounded-full bg-[#65793e] shadow-[0_0_8px_#65793e]"></span>
                    Runink Monitor
                </h3>

                <!-- Monitor Steps -->
                <div class="flex flex-col step-container w-full">
                    {{ range $index, $line := $monitorLines }}
                    {{ $lineClean := trim (replace $line "\\" "") " \n\r" }}
                    {{ $parts := split $lineClean "**" }}
                    {{ $title := "Phase Execution" }}
                    {{ $desc := $lineClean }}
                    {{ if gt (len $parts) 2 }}
                    {{ $title = trim (index $parts 1) " " }}
                    {{ $desc = trim (index $parts 2) " " }}
                    {{ end }}
                    {{ $stepNum := add $index 1 }}

                    <div
                        class="reveal-step opacity-20 translate-y-4 transition-all duration-700 ease-out mb-5 px-6 py-5 rounded-2xl border border-[#65793e]/30 bg-[#65793e]/5 shadow-[0_0_20px_rgba(101,121,62,0.2),inset_0_0_15px_rgba(101,121,62,0.1)] hover:shadow-[0_0_35px_rgba(101,121,62,0.4),inset_0_0_25px_rgba(101,121,62,0.2)] hover:bg-[#65793e]/10 hover:border-[#65793e]/50 flex flex-col md:flex-row items-start md:items-center justify-between group relative cursor-default w-full overflow-hidden gap-4">

                        <!-- Content -->
                        <div class="flex-grow z-10 relative pl-2 lg:pl-3 pr-2 text-sm md:text-base leading-relaxed">
                            {{ if gt (len $parts) 2 }}
                            <strong class="font-bold text-lg md:text-xl block lg:inline lg:mr-2 tracking-tight"
                                style="color: #65793e;">{{
                                $title }}</strong>
                            <span class="text-stone-300 group-hover:text-stone-200 transition-colors duration-500">{{
                                $desc }}</span>
                            {{ else }}
                            <span class="text-stone-300 group-hover:text-stone-200 transition-colors duration-500">{{
                                $desc }}</span>
                            {{ end }}
                        </div>

                        <!-- Badge (Right) -->
                        <div class="shrink-0 z-20 self-end md:self-auto">
                            <span
                                class="inline-flex items-center justify-center bg-[#65793e]/10 border border-[#65793e]/30 text-[#65793e] font-mono text-[11px] tracking-widest px-4 py-2 rounded-full shadow-[0_0_15px_rgba(101,121,62,0.15)] group-hover:bg-[#65793e]/20 transition-all uppercase font-bold whitespace-nowrap">Step
                                {{ $stepNum }}</span>
                        </div>
                    </div>
                    {{ end }}
                </div>

                <!-- Cockpit Header -->
                <h3 class="text-lg font-bold text-white tracking-tight flex items-center gap-3 mt-12 mb-4">
                    <span class="w-2 h-2 rounded-full bg-[#991b1b] shadow-[0_0_8px_#991b1b]"></span>
                    Decision Cockpit
                </h3>

                <!-- Cockpit Steps -->
                <div class="flex flex-col step-container pb-8 w-full">
                    {{ $monitorCount := len $monitorLines }}
                    {{ range $index, $line := $cockpitLines }}
                    {{ $lineClean := trim (replace $line "\\" "") " \n\r" }}
                    {{ $parts := split $lineClean "**" }}
                    {{ $title := "Phase Execution" }}
                    {{ $desc := $lineClean }}
                    {{ if gt (len $parts) 2 }}
                    {{ $title = trim (index $parts 1) " " }}
                    {{ $desc = trim (index $parts 2) " " }}
                    {{ end }}
                    {{ $stepNum := add $index (add $monitorCount 1) }}

                    <div
                        class="reveal-step opacity-20 translate-y-4 transition-all duration-700 ease-out mb-5 px-6 py-5 rounded-2xl border border-[#991b1b]/30 bg-[#991b1b]/5 shadow-[0_0_20px_rgba(153,27,27,0.2),inset_0_0_15px_rgba(153,27,27,0.1)] hover:shadow-[0_0_35px_rgba(153,27,27,0.4),inset_0_0_25px_rgba(153,27,27,0.2)] hover:bg-[#991b1b]/10 hover:border-[#991b1b]/50 flex flex-col md:flex-row items-start md:items-center justify-between group relative cursor-default w-full overflow-hidden gap-4">

                        <!-- Content -->
                        <div class="flex-grow z-10 relative pl-2 lg:pl-3 pr-2 text-sm md:text-base leading-relaxed">
                            {{ if gt (len $parts) 2 }}
                            <strong class="font-bold text-lg md:text-xl block lg:inline lg:mr-2 tracking-tight"
                                style="color: #991b1b;">{{
                                $title }}</strong>
                            <span class="text-stone-300 group-hover:text-stone-200 transition-colors duration-500">{{
                                $desc }}</span>
                            {{ else }}
                            <span class="text-stone-300 group-hover:text-stone-200 transition-colors duration-500">{{
                                $desc }}</span>
                            {{ end }}
                        </div>

                        <!-- Badge (Right) -->
                        <div class="shrink-0 z-20 self-end md:self-auto">
                            <span
                                class="inline-flex items-center justify-center bg-[#991b1b]/10 border border-[#991b1b]/30 text-[#991b1b] font-mono text-[11px] tracking-widest px-4 py-2 rounded-full shadow-[0_0_15px_rgba(153,27,27,0.2)] group-hover:bg-[#991b1b]/20 transition-all uppercase font-bold whitespace-nowrap">Step
                                {{ $stepNum }}</span>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const steps = entry.target.querySelectorAll('.reveal-step');
                    if (entry.isIntersecting) {
                        steps.forEach((step, idx) => {
                            // Delay each step by 200ms dynamically
                            step.style.transitionDelay = `${idx * 200}ms`;
                            step.classList.remove('opacity-20', 'translate-y-4');
                            step.classList.add('opacity-100', 'translate-y-0');
                        });
                    } else {
                        // Reset when scrolled out, so it triggers next time
                        steps.forEach(step => {
                            step.style.transitionDelay = '0ms'; // reset delay immediately so hide is instant
                            step.classList.add('opacity-20', 'translate-y-4');
                            step.classList.remove('opacity-100', 'translate-y-0');
                        });
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: "0px 0px -15% 0px"
            });

            // Delay observer mount to allow layout to settle
            setTimeout(() => {
                document.querySelectorAll('.step-container').forEach(container => {
                    observer.observe(container);
                });
            }, 100);
        });
    </script>
</div>